<div id="profile-modal" class="modal" style="display: none;">
    <div class="modal-content">
        <span class="close-button" id="profile-close-btn">&times;</span>
        <h2>Profile Settings</h2>

        <!-- Main Settings View -->
        <div id="main-settings-view">
            <div class="profile-pic-display-area" id="profile-pic-display-area">
                <div class="current-profile-pic-wrapper">
                    <img src="{{ url_for('static', filename='img/avatars/default_profile.jpeg') }}" alt="Profile Picture" class="current-profile-pic" id="modal-profile-pic">
                    <div class="profile-pic-overlay">
                        <img src="{{ url_for('static', filename='img/edit-pencil.svg') }}" alt="Edit" class="profile-pic-edit-icon">
                    </div>
                </div>
            </div>

            <div class="username-area" id="username-area">
                <span class="username-text" id="username-text">Your Name</span>
                <input type="text" class="username-input" id="username-input" style="display: none;">
                <img src="{{ url_for('static', filename='img/edit-pencil.svg') }}" alt="Edit" class="profile-pic-edit-icon" id="username-edit-icon">
            </div>

            <!-- Grey line below name and PFP -->
            <div class="profile-section-divider"></div>

            <!-- Theme Section -->
            <div class="profile-section">
                <h3 class="profile-section-title text-center">Theme</h3>
                <div class="theme-options-container">
                    <!-- Light Mode Option -->
                    <label class="theme-option-label" for="light-theme-radio">
                        <div class="theme-preview-box" id="light-mode-preview">
                            <img src="{{ url_for('static', filename='img/light-mode-preview.png') }}" alt="Light Mode Preview" class="theme-preview-image">
                        </div>
                        <input type="radio" name="theme" value="light" id="light-theme-radio" class="hidden-radio"> Light Mode
                    </label>

                    <!-- Dark Mode Option -->
                    <label class="theme-option-label" for="dark-theme-radio">
                        <div class="theme-preview-box" id="dark-mode-preview">
                            <img src="{{ url_for('static', filename='img/dark-mode-preview.png') }}" alt="Dark Mode Preview" class="theme-preview-image">
                        </div>
                        <input type="radio" name="theme" value="dark" id="dark-theme-radio" class="hidden-radio"> Dark Mode
                    </label>
                </div>
            </div>

            <div class="profile-section">
                <h3>API Key Settings</h3>
                <label class="toggle-switch">
                    <input type="checkbox" id="use-own-api-key-toggle">
                    <span class="slider round"></span> <span class="toggle-text">Use your own NewsAPI Key</span> {# MODIFIED: WRAPPED TEXT IN SPAN #}
                </label>
                <div id="news-api-key-input-container" style="margin-top: 15px;">
                    <div class="api-key-field-group">
                        <label for="news-api-key-input">NewsAPI Key:</label>
                        <input type="password" id="news-api-key-input" placeholder="Enter NewsAPI Key">
                    </div>
                    <div class="api-key-field-group">
                        <label for="gemini-api-key-input">Gemini Key:</label>
                        <input type="password" id="gemini-api-key-input" placeholder="Enter Gemini Key">
                    </div>
                    <button id="save-api-keys-btn" class="btn secondary-btn">Save Keys for Session</button>
                    <p id="api-key-message" class="text-center text-sm mt-2" style="display: none;"></p>
                </div>
            </div>
        </div>

        <!-- Avatar Selection View (existing) -->
        <div class="profile-pic-options-view" id="profile-pic-options-view" style="display: none;">
            <button class="back-button-modal" id="back-to-settings-btn"><i class="fas fa-arrow-left"></i> Back</button>
            <h3 class="profile-section-title">Choose Your Avatar</h3>
            <div class="selected-pfp-top-display">
                <img src="{{ url_for('static', filename='img/avatars/default_profile.jpeg') }}" alt="Selected Avatar" class="selected-pfp-top" id="selected-pfp-top-img">
            </div>
            <div class="avatar-options-grid" id="avatar-options-grid">
                <!-- Avatar options will be rendered here by JavaScript -->
            </div>
        </div>
    </div>
</div>